<!DOCTYPE html>
<html>
<head>
  <title>Absen Siswa</title>
  <link rel="stylesheet" href="siswa.css">
</head>
<body>

<script>
  if(localStorage.getItem("role") !== "siswa"){
    window.location.href = "index.html";
  }
</script>

<h2>Form Absen Siswa</h2>
  
<div class="clock-box">
  <div id="clock"></div>
  <div id="date"></div>
</div>

<button id="absenBtn" onclick="absen()">ABSEN SEKARANG</button>
<p id="absenStatus"></p>
  
<form id="absenForm">
  <input type="text" id="nama" placeholder="Nama Siswa" required>

  <select id="kelas" required>
    <option value="">Pilih Kelas</option>
    <option>X TKJ 1</option>
    <option>X TKJ 2</option>
    <option>X TKJ 3</option>
  </select>

  <select id="status" required>
    <option>Hadir</option>
    <option>Izin</option>
    <option>Sakit</option>
    <option>Alfa</option>
  </select>

  <button type="submit">Simpan Absen</button>
</form>

<p id="notif"></p>

<script src="data.js"></script>
<script src="logout.js"></script>
  <script>
const openHour = 21;   // jam buka absen
const closeHour = 22;  // jam tutup absen

function updateClock(){
  const now = new Date();

  const h = String(now.getHours()).padStart(2,'0');
  const m = String(now.getMinutes()).padStart(2,'0');
  const s = String(now.getSeconds()).padStart(2,'0');

  const days = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
  const months = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];

  document.getElementById("clock").innerText = `${h}:${m}:${s}`;
  document.getElementById("date").innerText =
    `${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;

  checkAbsenTime(now.getHours());
}

function checkAbsenTime(hour){
  const btn = document.getElementById("absenBtn");
  const status = document.getElementById("absenStatus");

  if(hour >= openHour && hour < closeHour){
    btn.disabled = false;
    status.innerText = "⏰ Waktu absen dibuka";
    status.style.color = "#16a34a";
  }else{
    btn.disabled = true;
    status.innerText = "❌ Absen ditutup (21:00 - 22:00)";
    status.style.color = "#dc2626";
  }
}

function absen(){
  const user = localStorage.getItem("loginUser");
  const time = new Date().toLocaleTimeString();

  let data = JSON.parse(localStorage.getItem("absen")) || [];
  data.push({
    user: user,
    waktu: time,
    tanggal: new Date().toLocaleDateString()
  });

  localStorage.setItem("absen", JSON.stringify(data));
  document.getElementById("absenStatus").innerText = "✅ Absen berhasil";
}

setInterval(updateClock,1000);
updateClock();
                 </script>  
</body>
</html>
